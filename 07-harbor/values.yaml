# Harbor Helm values
# Passwords are substituted by deploy.sh from config.env

externalURL: https://harbor.apps.house.simonellistonball.com
harborAdminPassword: HARBOR_ADMIN_PASSWORD_PLACEHOLDER

expose:
  type: clusterIP
  tls:
    enabled: false  # TLS handled by Traefik

# External PostgreSQL
database:
  type: external
  external:
    host: POSTGRES_HOST_PLACEHOLDER
    port: "5432"
    username: harbor
    password: POSTGRES_HARBOR_PASSWORD_PLACEHOLDER
    coreDatabase: harbor
    notaryServerDatabase: harbor_notary_server
    notarySignerDatabase: harbor_notary_signer

# Use internal Redis for simplicity
redis:
  type: internal

persistence:
  enabled: true
  persistentVolumeClaim:
    registry:
      storageClass: nfs-fast
      size: 100Gi
    jobservice:
      storageClass: nfs-fast
      size: 5Gi
    trivy:
      storageClass: nfs-fast
      size: 5Gi

# Disable Notary (deprecated)
notary:
  enabled: false

# Enable metrics
metrics:
  enabled: true
  serviceMonitor:
    enabled: true

# CA trust bundle from trust-manager
# This allows Harbor components to trust internal CA-signed certificates
caBundleSecretName: ""
caSecretName: ""

# Add CA bundle to core component
core:
  extraVolumes:
    - name: ca-bundle
      configMap:
        name: simonellistonball-ca-bundle
  extraVolumeMounts:
    - name: ca-bundle
      mountPath: /etc/ssl/certs/ca-certificates.crt
      subPath: ca-certificates.crt
      readOnly: true

# Add CA bundle to jobservice
jobservice:
  extraVolumes:
    - name: ca-bundle
      configMap:
        name: simonellistonball-ca-bundle
  extraVolumeMounts:
    - name: ca-bundle
      mountPath: /etc/ssl/certs/ca-certificates.crt
      subPath: ca-certificates.crt
      readOnly: true

# Add CA bundle to registry
registry:
  extraVolumes:
    - name: ca-bundle
      configMap:
        name: simonellistonball-ca-bundle
  extraVolumeMounts:
    - name: ca-bundle
      mountPath: /etc/ssl/certs/ca-certificates.crt
      subPath: ca-certificates.crt
      readOnly: true

# Enable Trivy vulnerability scanning with CA bundle
trivy:
  enabled: true
  extraVolumes:
    - name: ca-bundle
      configMap:
        name: simonellistonball-ca-bundle
  extraVolumeMounts:
    - name: ca-bundle
      mountPath: /etc/ssl/certs/ca-certificates.crt
      subPath: ca-certificates.crt
      readOnly: true
